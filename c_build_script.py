# -------------------------------- GENERATED BY C_BUILD --------------------------------
import os
import sys

def FIND_C_BUILD(current_dir):
    if os.path.isdir(os.path.join(current_dir, "c_build")):
        sys.path.insert(0, current_dir)
        return

    parent_dir = os.path.dirname(current_dir)
    if parent_dir != current_dir:
        FIND_C_BUILD(parent_dir)

FIND_C_BUILD(os.path.abspath(os.path.dirname(__file__)))
from c_build.source.UserUtilities import *
from c_build.source.Manager import *
# --------------------------------------------------------------------------------------s

pc: ProjectConfig = ProjectConfig(
    project_name = "OpenGL_TechDemo",
    project_dependencies = [
        Dependency(
            name="ckg",
            branch_name="CompleteRewrite"
        ),
        Dependency(
            name="GameMath",
            branch_name="Rework",
        ), 
        Dependency(
            name="IOD"
        )
    ],
    project_debug_with_visual_studio = False,
    project_rebuild_project_dependencies = False,
    project_executable_names  = ["OpenGL_TechDemo.exe"]
)

cc: CompilerConfig = CompilerConfig(
    compiler_name = C_BUILD_COMPILER_NAME() if C_BUILD_IS_DEPENDENCY() else "INVALID_COMPILER",
    compiler_std_version = "",
    compiler_warning_level = "",
    compiler_disable_specific_warnings = [""],
    compiler_treat_warnings_as_errors = True,
    compiler_disable_warnings  = False,
    compiler_disable_sanitizer = True
)

if IS_WINDOWS() and not C_BUILD_IS_DEPENDENCY():
    cc.compiler_name = "cl"
elif IS_DARWIN() and not C_BUILD_IS_DEPENDENCY():
    cc.compiler_name = "clang"
elif IS_LINUX() and not C_BUILD_IS_DEPENDENCY():
    cc.compiler_name = "gcc"

# Do different things depending on the platform
if cc.compiler_name == "cl":
    cc.compiler_warning_level = "4"
    cc.compiler_disable_specific_warnings = ["4244", "4100", "4458", "4201"]
else:
    cc.compiler_warning_level = ""
    cc.compiler_disable_specific_warnings = [
        "deprecated", 
        "parentheses", 
        "implicit-fallthrough",
        "unused-variable"
    ]


glfw_lib_path = "../../Libraries/glfw/" 
if cc.compiler_name == "cl":
    glfw_lib_path += "lib-static-ucrt/glfw3dll.lib"
else:
    glfw_lib_path += "lib-mingw-w64/libglfw3dll.a"


build_postfix = f"build_{cc.compiler_name}/{C_BUILD_BUILD_TYPE()}"

libs = [
    GET_LIB_FLAG(cc, "Kernel32"),
    GET_LIB_FLAG(cc, "User32"),
    GET_LIB_FLAG(cc, "Gdi32"),
    GET_LIB_FLAG(cc, "OpenGL32"),
    f"../../ckg/{build_postfix}/{GET_LIB_NAME(cc, "ckg")}",
    f"../../GameMath/{build_postfix}/{GET_LIB_NAME(cc, "gm")}",
    f"../../IOD/{build_postfix}/{GET_LIB_NAME(cc, "IOD")}",
    f"../../Libraries/assimp/{GET_LIB_NAME(cc, "assimp-vc143-mtd")}",
    glfw_lib_path
]

C_BUILD_COMPILER_NAME

procedures_config = {
    "OpenGL_TechDemo": ProcedureConfig(
        build_directory = f"./{build_postfix}",
        output_name = f"OpenGL_TechDemo.exe",
        source_files = [
            "../../Source/*.cpp",
            "../../Source/Loader/*.cpp",
            "../../Libraries/glad/src/glad.c"
        ],
        additional_libs = libs,
        include_paths = [
            "../../Include", 
            "../../Include/Loader", 
            "../../ckg",
            "../../GameMath",
            "../../IOD",
            "../../Libraries",
            "../../Libraries/stb",
            "../../Libraries/glad/include", 
            "../../Libraries/glfw",
            "../../Libraries/assimp/include",
        ],
    )
}

manager: Manager = Manager(cc, pc, procedures_config)
manager.build_project()
# ------------------------------------------------------------------------------------